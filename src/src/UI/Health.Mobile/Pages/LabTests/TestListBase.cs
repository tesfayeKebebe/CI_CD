using Microsoft.AspNetCore.Components;
using Radzen;
using Health.Mobile.Pages.ViewModel;
using Health.Mobile.Server.Models.LabTests;
using Health.Mobile.StateManagement;

namespace Health.Mobile.Pages.LabTests;

public class TestListBase : ComponentBase
{
   [Parameter] public LabTestCategory? Category { get; set; }
   [Inject] private LabTestCategoryStateService LabTestCategoryStateServiceService { get; set; } = null!;
   [Parameter] public HashSet<string> SelectedLabTests { get; set; } = null!;
   [Inject] public  DialogService DialogService { get; set; }= null!;
    protected void OnSelect(LabTestCategory labTest, LabTestPriceDetail test)
   {
      foreach (var (_, cat) in LabTestCategoryStateServiceService.ViewModels )
      {
         if (cat.LabTests.ContainsKey(test.Id))
         {
            test.Selected = false;
            LabTestCategoryStateServiceService.RemoveLabTest(test);
            StateHasChanged();
            return;
         }
      }
      test.Selected = true;
      LabTestCategoryStateServiceService.AddLabTest(labTest,test);
      StateHasChanged();
   }

   protected void OnChange(LabTestCategory labTest, LabTestPriceDetail test)
   {
      foreach (var (_, cat) in LabTestCategoryStateServiceService.ViewModels )
      {
         if (cat.LabTests.ContainsKey(test.Id))
         {
            LabTestCategoryStateServiceService.RemoveLabTest(test);
            test.Selected = false;
            StateHasChanged();
            return;
         }
      }
      LabTestCategoryStateServiceService.AddLabTest(labTest,test);
      test.Selected = true;
      StateHasChanged();
   }

   protected async  Task OnShow(LabTestPriceDetail test)
   {

         var data = new LabTestDetailViewModel
         {
            Id = test.Id,
            Name = test.Name
         };
         await DialogService.OpenAsync<LabTestDetailInformation>("",
            new Dictionary<string, object>() {{"LabTestDetailViewModel", data}},
            new DialogOptions {Width = "50%", Height = "100%", Style = "position: absolute; Top:80px; " });
         StateHasChanged();


   }
}